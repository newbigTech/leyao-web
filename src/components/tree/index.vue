<template>
  <div class="_tree-box">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" style="position: absolute; width: 0; height: 0; overflow: hidden;">
      <defs>
        <symbol id="icon-more" viewBox="0 0 16 16">
          <g transform="scale(0.015625, 0.015625)">
            <path d="M145.774061 634.075313c67.420529 0 122.075313-54.654784 122.075313-122.075313S213.193567 389.924687 145.774061 389.924687 23.697725 444.579471 23.697725 512 78.353532 634.075313 145.774061 634.075313L145.774061 634.075313zM145.774061 593.383542c-44.946678 0-81.383542-36.436864-81.383542-81.383542s36.436864-81.383542 81.383542-81.383542 81.383542 36.436864 81.383542 81.383542S190.720739 593.383542 145.774061 593.383542L145.774061 593.383542zM512 634.075313c67.420529 0 122.075313-54.654784 122.075313-122.075313s-54.654784-122.075313-122.075313-122.075313S389.924687 444.579471 389.924687 512 444.579471 634.075313 512 634.075313L512 634.075313zM512 593.383542c-44.946678 0-81.383542-36.436864-81.383542-81.383542s36.436864-81.383542 81.383542-81.383542 81.383542 36.436864 81.383542 81.383542S556.946678 593.383542 512 593.383542L512 593.383542zM878.225939 634.075313c67.420529 0 122.075313-54.654784 122.075313-122.075313s-54.654784-122.075313-122.075313-122.075313-122.075313 54.654784-122.075313 122.075313S810.80541 634.075313 878.225939 634.075313L878.225939 634.075313zM878.225939 593.383542c-44.946678 0-81.383542-36.436864-81.383542-81.383542s36.436864-81.383542 81.383542-81.383542 81.383542 36.436864 81.383542 81.383542S923.172617 593.383542 878.225939 593.383542L878.225939 593.383542z"></path>
          </g>
        </symbol>
        <symbol id="icon-unchecked" viewBox="0 0 16 16">
          <g transform="scale(0.015625, 0.015625)">
            <path d="M832 928.00086l-640 0c-52.9288 0-96.00086-43.07206-96.00086-95.99914l0-640c0-52.9288 43.07206-96.00086 96.00086-96.00086l640 0c52.92708 0 95.99914 43.07206 95.99914 96.00086l0 640C928.00086 884.9288 884.9288 928.00086 832 928.00086zM192 160.00086c-17.632039 0-32.00086 14.368821-32.00086 32.00086l0 640c0 17.664722 14.368821 31.99914 32.00086 31.99914l640 0c17.664722 0 31.99914-14.336138 31.99914-31.99914l0-640c0-17.632039-14.336138-32.00086-31.99914-32.00086L192 160.00086z"  />
          </g>
        </symbol>
        <symbol id="icon-checked" viewBox="0 0 16 16">
          <g transform="scale(0.015625, 0.015625)">
            <path d="M726.976697 393.184142c-12.54369-12.447359-32.831716-12.320065-45.248112 0.25631L448.447252 629.248757l-103.26354-106.112189c-12.352748-12.703669-32.60809-12.927295-45.248112-0.639914-12.672705 12.320065-12.959978 32.60809-0.639914 45.248112l126.016611 129.503454c0.063647 0.096331 0.192662 0.096331 0.25631 0.192662 0.063647 0.063647 0.096331 0.192662 0.159978 0.25631 2.016073 1.983389 4.512082 3.19957 6.880796 4.544765 1.247144 0.672598 2.239699 1.792447 3.519527 2.303346 3.872168 1.599785 8.000645 2.399677 12.096439 2.399677 4.06483 0 8.12794-0.799892 11.967424-2.33603 1.247144-0.512619 2.208735-1.536138 3.392232-2.176052 2.399677-1.343475 4.895686-2.528692 6.944443-4.544765 0.063647-0.063647 0.096331-0.192662 0.192662-0.25631 0.063647-0.096331 0.159978-0.127295 0.25631-0.192662l256.223626-259.008628C739.647682 425.888563 739.520387 405.631501 726.976697 393.184142z"  />
            <path d="M832 928.00086l-640 0c-52.9288 0-96.00086-43.07206-96.00086-95.99914l0-640c0-52.9288 43.07206-96.00086 96.00086-96.00086l640 0c52.92708 0 95.99914 43.07206 95.99914 96.00086l0 640C928.00086 884.9288 884.9288 928.00086 832 928.00086zM192 160.00086c-17.632039 0-32.00086 14.368821-32.00086 32.00086l0 640c0 17.664722 14.368821 31.99914 32.00086 31.99914l640 0c17.664722 0 31.99914-14.336138 31.99914-31.99914l0-640c0-17.632039-14.336138-32.00086-31.99914-32.00086L192 160.00086z"  />
          </g>
        </symbol>
        <symbol id="icon-check" viewBox="0 0 16 16">
          <g transform="scale(0.015625, 0.015625)">
            <path d="M887.904744 298.20852c-12.863647-12.063755-33.151673-11.487488-45.215428 1.408843L415.935493 753.983819 182.815858 524.287381c-12.607338-12.416396-32.8644-12.287381-45.280796 0.319957-12.416396 12.576374-12.256417 32.8644 0.352641 45.248112l256.479935 252.671415c0.096331 0.096331 0.223626 0.127295 0.319957 0.223626s0.127295 0.223626 0.223626 0.319957c2.016073 1.919742 4.448434 3.008628 6.784464 4.288456 1.152533 0.672598 2.143368 1.663432 3.359548 2.143368 3.775837 1.47249 7.775299 2.239699 11.743798 2.239699 4.192125 0 8.384249-0.832576 12.287381-2.496009 1.312512-0.543583 2.33603-1.663432 3.552211-2.368714 2.399677-1.408843 4.895686-2.59234 6.944443-4.67206 0.096331-0.096331 0.127295-0.25631 0.223626-0.352641 0.063647-0.096331 0.192662-0.127295 0.287273-0.223626L889.277463 343.420508C901.439269 330.591265 900.768391 310.335923 887.904744 298.20852z"></path>
          </g>
        </symbol>
        <symbol id="icon-span" viewBox="0 0 16 16">
          <g transform="scale(0.015625, 0.015625)">
            <path d="M0 0l1024 0 0 1024-1024 0 0-1024Z"></path>
          </g>
        </symbol>
        <symbol id="icon-caret-right" viewBox="0 0 16 16">
          <g transform="scale(0.015625, 0.015625)">
            <path d="M665.152 512q0 14.848-10.848 25.728l-256 256q-10.848 10.848-25.728 10.848t-25.728-10.848-10.848-25.728l0-512q0-14.848 10.848-25.728t25.728-10.848 25.728 10.848l256 256q10.848 10.848 10.848 25.728z"></path>
          </g>
        </symbol>
        <symbol id="icon-caret-down" viewBox="0 0 16 16">
          <g transform="scale(0.015625, 0.015625)">
            <path d="M793.526373 409.882228l-255.82655 255.82655c-14.275121 14.274098-37.125549 14.274098-51.40067 0l-255.82655-255.82655c-23.976064-20.558222-5.136997-63.956637 25.695219-62.247716l511.653099 0C798.66337 345.92559 817.502437 389.324006 793.526373 409.882228z"></path>
          </g>
        </symbol>
      </defs>
    </svg>
    <div class="_tree-header">
      <h3>{{title}}</h3>
      <div>
        <slot name="tree-header"></slot>
        <button class="btn btn-sm btn-default" style="padding: 3px 10px;" @click="add_top" v-if="type !== 'treeSelect'">增加顶层分类</button>
      </div>
    </div>
    <ul class="_tree" :class="{'_tree-select': type === 'treeSelect'}">
      <slot name="tree-body"></slot>
      <tree-item
        v-for="(m, i) in treeData"
        :key="m[id]"
        :cid="m[id]"
        :model="m"
        :index="i"
        :class="{'has-children': m.children && m.children.length > 0}"
        :e="e"
        :d="treeData"
        :type="type"
        :label="label"
        :id="id"
      ></tree-item>
    </ul>
  </div>
</template>

<script>
  // import "./_style.scss"
  import treeItem from "./_tree-item"
  export default {
    name: "tree",
    props: {
      treeData: {
        type: Array,
        default: () => []
      },
      title: {
        type: String,
        default: ""
      },
      type: {
        type: String,
        default: ""
      },
      label: {
        type: String,
        default: "name",
      },
      id: {
        type: String,
        default: "cid"
      },
    },
    components: { treeItem },
    data() {
      return {
        e: new this.$root.constructor()
      }
    },

    created() {
      this.e.$on('treeRename',(...arg) => this.$emit('treeRename', ...arg))
      this.e.$on('treeAdd',(...arg) => this.$emit('treeAdd', ...arg))
      this.e.$on('treeRemove',(...arg) => this.$emit('treeRemove', ...arg))
      this.e.$on('treeClick',(...arg) => this.$emit('treeClick', ...arg))
      this.e.$on('treeCheck',(...arg) => this.$emit('treeCheck', ...arg))
    },

    methods: {
      add_top() {
        this.$prompt('请输入类别名称', `新增顶级分类`, {
          inputPattern: /^([\u4e00-\u9fa5]|[a-zA-Z0-9_]){1,15}$/,
          inputErrorMessage: '分类名称输入错误'
        })
        .then(({ value }) => {
          this.e.$emit('treeAdd', { name: value })
        })
        .catch(() => {})
      },

      add(arg) {
        console.log("treeAdd_o", arg)
        this.$emit('treeAdd', arg)
      },
      rename(arg) {
        console.log("treeRename_o", arg)
        this.$emit('treeRename', arg)
        console.log(this)
      },
      remove(arg) {
        console.log("treeRemove_o", arg)
        this.$emit('treeRemove', arg)
      }
    }
  }
</script>
